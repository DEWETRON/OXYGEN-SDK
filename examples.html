

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example: Sync File Replay &mdash; Oxygen SDK 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/oxygen.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Template: Empty Software Channel Plugin" href="templates.html" />
    <link rel="prev" title="Translation" href="translation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Oxygen SDK
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About OxygenSDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_instructions.html">Build Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="software_channel_plugin.html">Software Channel Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="export_plugin.html">Export Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="channel_configuration.html">Oxygen Channel Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="translation.html">Translation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Example: Sync File Replay</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#source-code-of-main-file">Source Code of Main File</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#example-sync-async-channel">Example: Sync+Async Channel</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#example-bin-detector">Example: Bin Detector</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id2">Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#example-wav-export">Example: WAV Export</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id3">Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Template: Empty Software Channel Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html#template-empty-export-plugin">Template: Empty Export Plugin</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Oxygen SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Example: Sync File Replay</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="example-sync-file-replay">
<h1>Example: Sync File Replay<a class="headerlink" href="#example-sync-file-replay" title="Permalink to this headline">¶</a></h1>
<p>This example channel reads floating point values from the first column of a CSV file and writes them to a synchronous output channel.
Output frequency can be configured using the Sample rate setting. Playback loops when the end of the file is reached.</p>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Register a new Software Channel Type in Oxygen</p></li>
<li><p>Plugin channel provides editable filename (string) and sample rate (scalar) config items</p></li>
<li><p>Custom config item provides an english display name</p></li>
<li><p>Validate input file and update channel state accordingly</p></li>
<li><p>Set maximum range of output channel sample values</p></li>
<li><p>Write samples to a synchronous scalar output channel</p></li>
<li><p>UI extension to configure replay file</p></li>
<li><p>Custom request to demonstrate communication between UI and plugin</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Location</span><span class="p">:</span> <span class="n">examples</span><span class="o">/</span><span class="n">replay_sync_scalar</span>
<span class="n">Main</span> <span class="n">File</span><span class="p">:</span> <span class="n">odkex_replay_sync_scalar</span><span class="o">.</span><span class="n">cpp</span>
<span class="n">Plugin</span> <span class="n">Name</span><span class="p">:</span> <span class="n">ODK_REPLAY_SYNC_SCALAR</span>
<span class="n">Plugin</span> <span class="n">UUID</span><span class="p">:</span> <span class="n">E70860DB</span><span class="o">-</span><span class="mi">1</span><span class="n">A21</span><span class="o">-</span><span class="mi">4</span><span class="n">C1E</span><span class="o">-</span><span class="mi">8329</span><span class="o">-</span><span class="mi">55</span><span class="n">A1871ACC7A</span>
</pre></div>
</div>
</div>
<div class="section" id="source-code-of-main-file">
<h2>Source Code of Main File<a class="headerlink" href="#source-code-of-main-file" title="Permalink to this headline">¶</a></h2>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// Copyright DEWETRON GmbH 2019</span>

<span class="cp">#include</span> <span class="cpf">&quot;odkapi_config_item_keys.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;odkfw_custom_request_handler.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;odkfw_properties.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;odkfw_software_channel_plugin.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;odkbase_message_return_value_holder.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;odkapi_utils.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;qml.rcc.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;sdk_csv_utils.h&quot;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;functional&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="c1">// Manifest constains necessary metadata for oxygen plugins</span>
<span class="c1">//   OxygenPlugin.name: unique plugin identifier; please use your (company) name to avoid name conflicts. This name is also used as a prefix in all custom config item keys.</span>
<span class="c1">//   OxygenPlugin.uuid: unique number (generated by a GUID/UUID generator tool) that stored in configuration files to match channels etc. to the correct plugin</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">PLUGIN_MANIFEST</span> <span class="o">=</span>
<span class="sa">R</span><span class="s">&quot;</span><span class="dl">XML(</span><span class="s">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s">&lt;OxygenPlugin name=&quot;ODK_REPLAY_SYNC_SCALAR&quot; version=&quot;1.0&quot; uuid=&quot;E70860DB-1A21-4C1E-8329-55A1871ACC7A&quot;&gt;</span>
<span class="s">  &lt;Info name=&quot;Example Plugin: Simple file replay&quot;&gt;</span>
<span class="s">    &lt;Vendor name=&quot;DEWETRON GmbH&quot;/&gt;</span>
<span class="s">    &lt;Description&gt;SDK Example plugin implementing file replay into a synchronous scalar channel.&lt;/Description&gt;</span>
<span class="s">  &lt;/Info&gt;</span>
<span class="s">  &lt;Host minimum_version=&quot;5.3&quot;/&gt;</span>
<span class="s">  &lt;UsesUIExtensions/&gt;</span>
<span class="s">&lt;/OxygenPlugin&gt;</span>
<span class="dl">)XML</span><span class="s">&quot;</span><span class="p">;</span>

<span class="c1">// A minimal translation file that maps the internal ConfigItem key to a nicer text for the user</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">TRANSLATION_EN</span> <span class="o">=</span>
<span class="sa">R</span><span class="s">&quot;</span><span class="dl">XML(</span><span class="s">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s">&lt;TS version=&quot;2.1&quot; language=&quot;en&quot; sourcelanguage=&quot;en&quot;&gt;</span>
<span class="s">    &lt;context&gt;&lt;name&gt;ConfigKeys&lt;/name&gt;</span>
<span class="s">        &lt;message&gt;&lt;source&gt;ODK_REPLAY_SYNC_SCALAR/InputFile&lt;/source&gt;&lt;translation&gt;Input File&lt;/translation&gt;&lt;/message&gt;</span>
<span class="s">    &lt;/context&gt;</span>

<span class="s">    &lt;!-- Translations for custom UI item --&gt;</span>
<span class="s">    &lt;context&gt;&lt;name&gt;ODK_REPLAY_SYNC_SCALAR/AddChannel&lt;/name&gt;</span>
<span class="s">        &lt;message&gt;&lt;source&gt;Not a valid CSV file&lt;/source&gt;&lt;translation&gt;No valid CSV file selected&lt;/translation&gt;&lt;/message&gt;</span>
<span class="s">    &lt;/context&gt;</span>
<span class="s">&lt;/TS&gt;</span>
<span class="dl">)XML</span><span class="s">&quot;</span><span class="p">;</span>


<span class="c1">// Keys for ConfigItems that are used to store channel settings</span>

<span class="c1">// Custom key (prefixed by plugin name) to store path to the input file</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">KEY_INPUT_FILE</span> <span class="o">=</span> <span class="s">&quot;ODK_REPLAY_SYNC_SCALAR/InputFile&quot;</span><span class="p">;</span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">odk</span><span class="o">::</span><span class="n">framework</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ReplayChannel</span> <span class="o">:</span> <span class="k">public</span> <span class="n">SoftwareChannelInstance</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>

    <span class="n">ReplayChannel</span><span class="p">()</span>
        <span class="o">:</span> <span class="n">m_input_file</span><span class="p">(</span><span class="k">new</span> <span class="n">EditableStringProperty</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">))</span>
        <span class="p">,</span> <span class="n">m_acquisition_rate</span><span class="p">(</span><span class="k">new</span> <span class="n">EditableScalarProperty</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="s">&quot;Hz&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">))</span> <span class="c1">//SampleRate can be configured freely in a wide range (0.01 to 10000000 Hz)</span>
        <span class="p">,</span> <span class="n">m_next_tick</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// add some proposed sample rates</span>
        <span class="n">m_acquisition_rate</span><span class="o">-&gt;</span><span class="n">addOption</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">m_acquisition_rate</span><span class="o">-&gt;</span><span class="n">addOption</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="n">m_acquisition_rate</span><span class="o">-&gt;</span><span class="n">addOption</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Describe how the software channel should be shown in the &quot;Add Channel&quot; dialog</span>
    <span class="k">static</span> <span class="n">odk</span><span class="o">::</span><span class="n">RegisterSoftwareChannel</span> <span class="n">getSoftwareChannelInfo</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">odk</span><span class="o">::</span><span class="n">RegisterSoftwareChannel</span> <span class="n">telegram</span><span class="p">;</span>
        <span class="n">telegram</span><span class="p">.</span><span class="n">m_display_name</span> <span class="o">=</span> <span class="s">&quot;Example Plugin: Simple file replay&quot;</span><span class="p">;</span>
        <span class="n">telegram</span><span class="p">.</span><span class="n">m_service_name</span> <span class="o">=</span> <span class="s">&quot;CreateChannel&quot;</span><span class="p">;</span>
        <span class="n">telegram</span><span class="p">.</span><span class="n">m_display_group</span> <span class="o">=</span> <span class="s">&quot;Data Sources&quot;</span><span class="p">;</span>
        <span class="n">telegram</span><span class="p">.</span><span class="n">m_description</span> <span class="o">=</span> <span class="s">&quot;Adds a synchronous channel that delivers samples read from a CSV file.&quot;</span><span class="p">;</span>
        <span class="n">telegram</span><span class="p">.</span><span class="n">m_ui_item_add</span> <span class="o">=</span> <span class="s">&quot;AddChannel&quot;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">telegram</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="n">setup</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">odk</span><span class="o">::</span><span class="n">Property</span><span class="o">&gt;&amp;</span> <span class="n">properties</span><span class="p">)</span> <span class="k">override</span>
    <span class="p">{</span>
        <span class="n">odk</span><span class="o">::</span><span class="n">PropertyList</span> <span class="n">props</span><span class="p">(</span><span class="n">properties</span><span class="p">);</span>

        <span class="k">auto</span> <span class="n">csv_file</span> <span class="o">=</span> <span class="n">props</span><span class="p">.</span><span class="n">getString</span><span class="p">(</span><span class="s">&quot;ODK_REPLAY_SYNC_SCALAR/CSVFile&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">csv_file</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">m_input_file</span><span class="o">-&gt;</span><span class="n">setValue</span><span class="p">(</span><span class="n">csv_file</span><span class="p">);</span>
            <span class="n">update</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">updatePropertyTypes</span><span class="p">(</span><span class="k">const</span> <span class="n">PluginChannelPtr</span><span class="o">&amp;</span> <span class="n">output_channel</span><span class="p">)</span> <span class="k">override</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">updateStaticPropertyConstraints</span><span class="p">(</span><span class="k">const</span> <span class="n">PluginChannelPtr</span><span class="o">&amp;</span> <span class="n">channel</span><span class="p">)</span> <span class="k">override</span>
    <span class="p">{</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="n">update</span><span class="p">()</span> <span class="k">override</span>
    <span class="p">{</span>
        <span class="c1">// channel is only valid if we can properly parse the specified csv file</span>
        <span class="c1">// in production code the parsing should not be done on every config change, but only if the filename was updated</span>
        <span class="n">CSVNumberReader</span> <span class="n">csv</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">input_stream</span><span class="p">(</span><span class="n">m_input_file</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">());</span>

        <span class="n">m_next_tick</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">m_values</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>

        <span class="kt">double</span> <span class="n">range_min</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">();</span>
        <span class="kt">double</span> <span class="n">range_max</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">lowest</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">input_stream</span> <span class="o">&amp;&amp;</span> <span class="n">csv</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">input_stream</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">csv</span><span class="p">.</span><span class="n">m_values</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">m_values</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">csv</span><span class="p">.</span><span class="n">m_values</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
            <span class="kt">size_t</span> <span class="n">column_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="nl">row_values</span> <span class="p">:</span> <span class="n">csv</span><span class="p">.</span><span class="n">m_values</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">row_values</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">column_index</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">range_min</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">range_min</span><span class="p">,</span> <span class="n">row_values</span><span class="p">[</span><span class="n">column_index</span><span class="p">]);</span>
                    <span class="n">range_max</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">range_max</span><span class="p">,</span> <span class="n">row_values</span><span class="p">[</span><span class="n">column_index</span><span class="p">]);</span>
                    <span class="n">m_values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">row_values</span><span class="p">[</span><span class="n">column_index</span><span class="p">]);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">m_values</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">quiet_NaN</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kt">bool</span> <span class="n">is_valid</span> <span class="o">=</span> <span class="n">range_min</span> <span class="o">&lt;=</span> <span class="n">range_max</span><span class="p">;</span>

        <span class="n">getRootChannel</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">setRange</span><span class="p">({</span><span class="n">range_min</span><span class="p">,</span> <span class="n">range_max</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">});</span>
        <span class="n">getRootChannel</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">setValid</span><span class="p">(</span><span class="n">is_valid</span><span class="p">);</span>
        <span class="n">getRootChannel</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getRangeProperty</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">setLive</span><span class="p">(</span><span class="n">is_valid</span><span class="p">);</span>
        <span class="n">getRootChannel</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">setSimpleTimebase</span><span class="p">(</span><span class="n">m_acquisition_rate</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">().</span><span class="n">m_val</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">is_valid</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">create</span><span class="p">(</span><span class="n">odk</span><span class="o">::</span><span class="n">IfHost</span><span class="o">*</span> <span class="n">host</span><span class="p">)</span> <span class="k">override</span>
    <span class="p">{</span>
        <span class="n">getRootChannel</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">setDefaultName</span><span class="p">(</span><span class="s">&quot;Replay channel&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="n">setSampleFormat</span><span class="p">(</span>
                <span class="n">odk</span><span class="o">::</span><span class="n">ChannelDataformat</span><span class="o">::</span><span class="n">SampleOccurrence</span><span class="o">::</span><span class="n">SYNC</span><span class="p">,</span>
                <span class="n">odk</span><span class="o">::</span><span class="n">ChannelDataformat</span><span class="o">::</span><span class="n">SampleFormat</span><span class="o">::</span><span class="n">DOUBLE</span><span class="p">,</span>
                <span class="mi">1</span><span class="p">)</span>
            <span class="p">.</span><span class="n">setSimpleTimebase</span><span class="p">(</span><span class="n">m_acquisition_rate</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">().</span><span class="n">m_val</span><span class="p">)</span>
            <span class="p">.</span><span class="n">setDeletable</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
            <span class="p">.</span><span class="n">addProperty</span><span class="p">(</span><span class="n">KEY_INPUT_FILE</span><span class="p">,</span> <span class="n">m_input_file</span><span class="p">)</span>
            <span class="p">.</span><span class="n">addProperty</span><span class="p">(</span><span class="n">ODK_CI_KEY_ACQUISITION_RATE</span><span class="p">,</span> <span class="n">m_acquisition_rate</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">bool</span> <span class="n">configure</span><span class="p">(</span>
        <span class="k">const</span> <span class="n">odk</span><span class="o">::</span><span class="n">UpdateChannelsTelegram</span><span class="o">&amp;</span> <span class="n">request</span><span class="p">,</span>
        <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">uint32_t</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">uint32_t</span><span class="o">&gt;&amp;</span> <span class="n">channel_id_map</span><span class="p">)</span> <span class="k">override</span>
    <span class="p">{</span>
        <span class="n">configureFromTelegram</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">channel_id_map</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">prepareProcessing</span><span class="p">(</span><span class="n">odk</span><span class="o">::</span><span class="n">IfHost</span><span class="o">*</span> <span class="n">host</span><span class="p">)</span> <span class="k">override</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="k">auto</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">getMasterTimestamp</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>
        <span class="k">const</span> <span class="k">auto</span> <span class="n">rate_factor</span> <span class="o">=</span> <span class="n">m_acquisition_rate</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">().</span><span class="n">m_val</span> <span class="o">/</span> <span class="n">ts</span><span class="p">.</span><span class="n">m_frequency</span><span class="p">;</span>
        <span class="n">m_next_tick</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">uint64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">m_ticks</span><span class="o">*</span> <span class="n">rate_factor</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">process</span><span class="p">(</span><span class="n">ProcessingContext</span><span class="o">&amp;</span> <span class="n">context</span><span class="p">,</span> <span class="n">odk</span><span class="o">::</span><span class="n">IfHost</span> <span class="o">*</span><span class="n">host</span><span class="p">)</span> <span class="k">override</span>
    <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="kt">uint32_t</span> <span class="n">channel_id</span> <span class="o">=</span> <span class="n">getRootChannel</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getLocalId</span><span class="p">();</span>
        <span class="k">auto</span> <span class="n">ts</span> <span class="o">=</span> <span class="n">getMasterTimestamp</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>

        <span class="k">auto</span> <span class="n">tick</span> <span class="o">=</span> <span class="n">m_next_tick</span><span class="p">;</span>
        <span class="k">const</span> <span class="k">auto</span> <span class="n">rate_factor</span> <span class="o">=</span> <span class="n">m_acquisition_rate</span><span class="o">-&gt;</span><span class="n">getValue</span><span class="p">().</span><span class="n">m_val</span> <span class="o">/</span> <span class="n">ts</span><span class="p">.</span><span class="n">m_frequency</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="kt">uint64_t</span> <span class="n">target_tick</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">uint64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ts</span><span class="p">.</span><span class="n">m_ticks</span> <span class="o">*</span> <span class="n">rate_factor</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">tick</span> <span class="o">&lt;</span> <span class="n">target_tick</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">auto</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">tick</span> <span class="o">%</span> <span class="n">m_values</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
            <span class="k">auto</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">m_values</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="n">idx</span><span class="p">,</span> <span class="n">target_tick</span> <span class="o">-</span> <span class="n">tick</span><span class="p">);</span>
            <span class="n">addSamples</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">channel_id</span><span class="p">,</span> <span class="n">tick</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m_values</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="o">*</span> <span class="n">sz</span><span class="p">);</span>
            <span class="n">tick</span> <span class="o">+=</span> <span class="n">sz</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">m_next_tick</span> <span class="o">=</span> <span class="n">tick</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">EditableStringProperty</span><span class="o">&gt;</span> <span class="n">m_input_file</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">EditableScalarProperty</span><span class="o">&gt;</span> <span class="n">m_acquisition_rate</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">m_values</span><span class="p">;</span>

    <span class="n">std</span><span class="o">::</span><span class="kt">uint64_t</span> <span class="n">m_next_tick</span><span class="p">;</span> <span class="c1">// timestamp of the next sample that will be generated in doProcess()</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">ReplaySyncScalarPlugin</span> <span class="o">:</span> <span class="k">public</span> <span class="n">SoftwareChannelPlugin</span><span class="o">&lt;</span><span class="n">ReplayChannel</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
    <span class="n">ReplaySyncScalarPlugin</span><span class="p">()</span>
        <span class="o">:</span> <span class="n">m_custom_requests</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">odk</span><span class="o">::</span><span class="n">framework</span><span class="o">::</span><span class="n">CustomRequestHandler</span><span class="o">&gt;</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">addMessageHandler</span><span class="p">(</span><span class="n">m_custom_requests</span><span class="p">);</span>

        <span class="k">namespace</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">placeholders</span><span class="p">;</span>
        <span class="n">m_custom_requests</span><span class="o">-&gt;</span><span class="n">registerFunction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;checkCSVFile&quot;</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ReplaySyncScalarPlugin</span><span class="o">::</span><span class="n">checkCSVFile</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="n">arg</span><span class="o">::</span><span class="n">_1</span><span class="p">,</span> <span class="n">arg</span><span class="o">::</span><span class="n">_2</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="n">registerResources</span><span class="p">()</span> <span class="k">final</span>
    <span class="p">{</span>
        <span class="n">addTranslation</span><span class="p">(</span><span class="n">TRANSLATION_EN</span><span class="p">);</span>
        <span class="n">addQtResources</span><span class="p">(</span><span class="n">plugin_resources</span><span class="o">::</span><span class="n">QML_RCC_data</span><span class="p">,</span> <span class="n">plugin_resources</span><span class="o">::</span><span class="n">QML_RCC_size</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="kt">uint64_t</span> <span class="n">checkCSVFile</span><span class="p">(</span><span class="k">const</span> <span class="n">odk</span><span class="o">::</span><span class="n">PropertyList</span><span class="o">&amp;</span> <span class="n">params</span><span class="p">,</span> <span class="n">odk</span><span class="o">::</span><span class="n">PropertyList</span><span class="o">&amp;</span> <span class="n">returns</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">const</span> <span class="k">auto</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="n">getString</span><span class="p">(</span><span class="s">&quot;filename&quot;</span><span class="p">);</span>

        <span class="n">CSVNumberReader</span> <span class="n">csv</span><span class="p">;</span>
        <span class="n">std</span><span class="o">::</span><span class="n">ifstream</span> <span class="n">input_stream</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
        <span class="k">const</span> <span class="kt">bool</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">input_stream</span> <span class="o">&amp;&amp;</span> <span class="n">csv</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">input_stream</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">csv</span><span class="p">.</span><span class="n">m_values</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span>

        <span class="n">returns</span><span class="p">.</span><span class="n">setBool</span><span class="p">(</span><span class="s">&quot;valid&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">odk</span><span class="o">::</span><span class="n">error_codes</span><span class="o">::</span><span class="n">OK</span><span class="p">;</span>
    <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">odk</span><span class="o">::</span><span class="n">framework</span><span class="o">::</span><span class="n">CustomRequestHandler</span><span class="o">&gt;</span> <span class="n">m_custom_requests</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">OXY_REGISTER_PLUGIN1</span><span class="p">(</span><span class="s">&quot;ODK_REPLAY_SYNC_SCALAR&quot;</span><span class="p">,</span> <span class="n">PLUGIN_MANIFEST</span><span class="p">,</span> <span class="n">ReplaySyncScalarPlugin</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-sync-async-channel">
<h1>Example: Sync+Async Channel<a class="headerlink" href="#example-sync-async-channel" title="Permalink to this headline">¶</a></h1>
<p>This example demonstrates how to sum up sample values of two scalar input channels and write the result to an output channel.</p>
<div class="section" id="id1">
<h2>Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Register a new Software Channel Type in Oxygen</p></li>
<li><p>Plugin instance provides a Channel Id List Config Item to configure the two input channels</p></li>
<li><p>Config Item name is translated to English and German</p></li>
<li><p>Validate input channels and their type</p></li>
<li><p>Read samples from synchronous and/or asynchronous channels</p></li>
<li><p>Write samples to a synchronous and an asynchronous output channel</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Location</span><span class="p">:</span> <span class="n">examples</span><span class="o">/</span><span class="n">sync_plus_async_channel</span>
<span class="n">Main</span> <span class="n">File</span><span class="p">:</span> <span class="n">odkex_sync_plus_async_channel</span><span class="o">.</span><span class="n">cpp</span>
<span class="n">Plugin</span> <span class="n">Name</span><span class="p">:</span> <span class="n">ODK_SUM_CHANNELS</span>
<span class="n">Plugin</span> <span class="n">UUID</span><span class="p">:</span> <span class="n">D9C295C0</span><span class="o">-</span><span class="n">CBB9</span><span class="o">-</span><span class="mi">4412</span><span class="o">-</span><span class="mi">9</span><span class="n">B4A</span><span class="o">-</span><span class="mi">0</span><span class="n">C5B1ACF3EB6</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-bin-detector">
<h1>Example: Bin Detector<a class="headerlink" href="#example-bin-detector" title="Permalink to this headline">¶</a></h1>
<p>This example plugin detects the minimum and/or maximum values with the
corresponding bins out of an Oxygen vector channel (e.g. a fft channel).
All values and bins are written to separate asynchronous output channels.
Detecting min/max values and bins can be configured through the plugin
group channel setup page.</p>
<div class="section" id="id2">
<h2>Features<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Register a new Software Channel Type in Oxygen</p></li>
<li><p>Plugin group channel provides selectable config items for detecting min
and/or max values and their corresponding bins.</p></li>
<li><p>Creates output channels for values and bins dynamically. The name of
the selected input channel affects the name of the created output
channel names</p></li>
<li><p>Read samples from a vector channel</p></li>
<li><p>Write values and bins to corresponding asynchronous scalar output channels</p></li>
<li><p>Dynamic plugin config is stored and can be reloaded through oxygen
save/load config use case</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Location</span><span class="p">:</span> <span class="n">examples</span><span class="o">/</span><span class="n">bin_detector</span>
<span class="n">Main</span> <span class="n">File</span><span class="p">:</span> <span class="n">odkex_bin_detector</span><span class="o">.</span><span class="n">cpp</span>
<span class="n">Plugin</span> <span class="n">Name</span><span class="p">:</span> <span class="n">ODK_BIN_DETECTOR</span>
<span class="n">Plugin</span> <span class="n">UUID</span><span class="p">:</span> <span class="n">DCDF634A</span><span class="o">-</span><span class="mi">377</span><span class="n">B</span><span class="o">-</span><span class="mf">4E9</span><span class="n">F</span><span class="o">-</span><span class="mi">89</span><span class="n">BD</span><span class="o">-</span><span class="mi">09</span><span class="n">D54C9DFCD3</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-wav-export">
<h1>Example: WAV Export<a class="headerlink" href="#example-wav-export" title="Permalink to this headline">¶</a></h1>
<p>This example plugin exports channel data as WAV file</p>
<div class="section" id="id3">
<h2>Features<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li><p>Register custom exporter in Oxygen</p></li>
<li><p>Simple WAV file writer</p></li>
<li><p>Write channel samples to WAV file</p></li>
<li><p>UI extension to change format settings</p></li>
</ul>
</div></blockquote>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Location</span><span class="p">:</span> <span class="n">examples</span><span class="o">/</span><span class="n">wav_export</span>
<span class="n">Main</span> <span class="n">File</span><span class="p">:</span> <span class="n">odkex_wav_export</span><span class="o">.</span><span class="n">cpp</span>
<span class="n">Plugin</span> <span class="n">Name</span><span class="p">:</span> <span class="n">ODK_WAV_EXPORT</span>
<span class="n">Plugin</span> <span class="n">UUID</span><span class="p">:</span> <span class="mf">60e4627</span><span class="n">b</span><span class="o">-</span><span class="mi">8964</span><span class="o">-</span><span class="mi">4259</span><span class="o">-</span><span class="n">a9e0</span><span class="o">-</span><span class="mi">54</span><span class="n">d38847ae68</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="templates.html" class="btn btn-neutral float-right" title="Template: Empty Software Channel Plugin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="translation.html" class="btn btn-neutral float-left" title="Translation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, DEWETRON GmbH

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>