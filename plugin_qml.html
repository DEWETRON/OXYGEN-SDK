

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>QML for Oxygen Plugins &mdash; Oxygen SDK 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/oxygen.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example: Sync File Replay" href="examples.html" />
    <link rel="prev" title="UI Extensions" href="ui_extensions.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Oxygen SDK
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="about.html">About OxygenSDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_instructions.html">Build Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="software_channel_plugin.html">Software Channel Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="export_plugin.html">Export Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="channel_configuration.html">Oxygen Channel Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="translation.html">Translation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ui_extensions.html">UI Extensions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">QML for Oxygen Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-qml-items">Using QML Items</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#qml-and-qrc-files">QML and QRC Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-integration-cmake">Build Integration (CMake)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plugin-manifest">Plugin Manifest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upload-to-oxygen">Upload to Oxygen</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#qml-sandbox">QML Sandbox</a></li>
<li class="toctree-l2"><a class="reference internal" href="#available-items">Available Items</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-plugin-requests">Custom Plugin Requests</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#plugin-preparation">Plugin Preparation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementing-request-functions">Implementing Request Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performing-a-custom-request">Performing a Custom Request</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Example: Sync File Replay</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html#example-sync-async-channel">Example: Sync+Async Channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html#example-bin-detector">Example: Bin Detector</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html#example-wav-export">Example: WAV Export</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Template: Empty Software Channel Plugin</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html#template-empty-export-plugin">Template: Empty Export Plugin</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Oxygen SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>QML for Oxygen Plugins</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="qml-for-oxygen-plugins">
<span id="plugin-qml-intro"></span><h1>QML for Oxygen Plugins<a class="headerlink" href="#qml-for-oxygen-plugins" title="Permalink to this headline">¶</a></h1>
<div class="section" id="using-qml-items">
<h2>Using QML Items<a class="headerlink" href="#using-qml-items" title="Permalink to this headline">¶</a></h2>
<p>This section explains how to work with QML items in Oxygen plugins, which
is also illustrated by the <em>Sync File Replay</em> and <em>WAV Export</em> examples.</p>
<div class="section" id="qml-and-qrc-files">
<h3>QML and QRC Files<a class="headerlink" href="#qml-and-qrc-files" title="Permalink to this headline">¶</a></h3>
<p>First create the QML files you want to use in Oxygen.
Check out the <span class="xref std std-ref">UI extensions</span> for information on what
you can do with this feature.</p>
<p>These files and their dependencies should be listed in a Qt Resource Collection
(.qrc) file because we will use Qt Resource packages to upload everything to Oxygen.
See <a class="reference external" href="https://doc.qt.io/qt-5/resources.html">https://doc.qt.io/qt-5/resources.html</a> for more details.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE RCC&gt;</span><span class="nt">&lt;RCC</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;qresource&gt;</span>
  <span class="nt">&lt;file&gt;</span>./AddChannel.qml<span class="nt">&lt;/file&gt;</span>
  ...
<span class="nt">&lt;/qresource&gt;</span>
<span class="nt">&lt;/RCC&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="build-integration-cmake">
<h3>Build Integration (CMake)<a class="headerlink" href="#build-integration-cmake" title="Permalink to this headline">¶</a></h3>
<p>The plugin build needs to perform two extra steps:</p>
<blockquote>
<div><ul>
<li><p>Combine all required resources, as listed in the QRC file, into a single
binary package.</p>
<p>In your CMakeLists.txt this can be automated using the following commands:
<code class="docutils literal notranslate"><span class="pre">find_package(Qt5Core</span> <span class="pre">REQUIRED)</span></code>
<code class="docutils literal notranslate"><span class="pre">qt5_add_binary_resources(${LIBNAME}_qml</span> <span class="pre">input.qrc</span> <span class="pre">DESTINATION</span> <span class="pre">&quot;${CMAKE_CURRENT_BINARY_DIR}/output.rcc&quot;)</span></code></p>
</li>
<li><p>Ensure the plugin has access to the data output.rcc file during initialization.</p>
<p>The easiest way is to use the provided CMake scripts to link the file into the
plugin binary:</p>
<p><code class="docutils literal notranslate"><span class="pre">set(RESOURCE_DIR</span> <span class="pre">${CMAKE_CURRENT_BINARY_DIR}/resources)</span></code>
<code class="docutils literal notranslate"><span class="pre">include_directories(${RESOURCE_DIR})</span></code>
<code class="docutils literal notranslate"><span class="pre">AddResourceFile(${LIBNAME}</span> <span class="pre">&quot;${CMAKE_CURRENT_BINARY_DIR}/output.rcc&quot;</span> <span class="pre">${RESOURCE_DIR})</span></code></p>
<p>This generates C++ files containg the file data and builds them within
the project. The binary data can then be referenced using the variables
declared by the header, in this case <em>output.rcc.h</em>.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="plugin-manifest">
<h3>Plugin Manifest<a class="headerlink" href="#plugin-manifest" title="Permalink to this headline">¶</a></h3>
<p>The plugin manifest must contain the element <code class="docutils literal notranslate"><span class="pre">&lt;UsesUIExtensions/&gt;</span></code>
(within the element &lt;OxygenPlugin&gt;) to support any custom ui features.</p>
</div>
<div class="section" id="upload-to-oxygen">
<h3>Upload to Oxygen<a class="headerlink" href="#upload-to-oxygen" title="Permalink to this headline">¶</a></h3>
<p>The plugin class should implement the <code class="docutils literal notranslate"><span class="pre">registerResources()</span></code> method to
upload the resource pacakge by calling <code class="docutils literal notranslate"><span class="pre">addQtResources()</span></code>.</p>
<p>If you followed the steps above and linked the resource file into the plugin,
you can upload using the following commands:</p>
<p><code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;output.rcc.h&quot;</span></code>
<code class="docutils literal notranslate"><span class="pre">addQtResources(plugin_resources::OUTPUT_RCC_data,</span> <span class="pre">plugin_resources::OUTPUT_RCC_size);</span></code></p>
</div>
</div>
<div class="section" id="qml-sandbox">
<h2>QML Sandbox<a class="headerlink" href="#qml-sandbox" title="Permalink to this headline">¶</a></h2>
<p>The QML Sandbox is an Oxygen feature to facilitate authoring of QML items,
by previewing in-development content and providing easy iteration of the design.</p>
<p>Sandbox loads its content directly from the filesystem and cannot work with
ressource files.</p>
<p>It can be found in the “Developer” section in the “System Settings” tab.</p>
<dl class="simple">
<dt>To use it</dt><dd><ul class="simple">
<li><p>select the display context of the item you are developing,</p></li>
<li><p>select the folder where your QML ressources are stored,</p></li>
<li><p>and enter the name of the item that should be displayed.</p></li>
</ul>
</dd>
</dl>
<p>If the item needs <a class="reference internal" href="#custom-qml-request"><span class="std std-ref">custom requests</span></a>, your plugin
(which will respond to these requests) must be loaded and selected in the correspondig list.</p>
<p>Errors encountered while creating the item are displayed in the text field on the right.</p>
<p>If successfully loaded the item is displayed in the “Current Item” section.
The size of this area can be changed to test dynamic layouts.</p>
<p>After changing a file on disk, the “Reload files” button can be used to refresh
ressources an recreate the item using the new sources.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The reload feature does not work properly in Oxygen 5.3.0, because the item
remains cached and is not parsed again!</p>
</div>
</div>
<div class="section" id="available-items">
<h2>Available Items<a class="headerlink" href="#available-items" title="Permalink to this headline">¶</a></h2>
<p>Oxygen plugins may only use QML features and items described in this documentation,
to ensure compatibility with future Oxygen versions.</p>
<p>If Oxygen provides items for a specific use case the have to be used for better
consistency and interoperability, but standard QML components that are provided,
and not deprecated, in Qt 5.12.6 may be used in other cases.</p>
<p>For example you should use the customized Oxygen version of standard controls,
but the usual QML Layouts to arrange them.</p>
</div>
<div class="section" id="custom-plugin-requests">
<span id="custom-qml-request"></span><h2>Custom Plugin Requests<a class="headerlink" href="#custom-plugin-requests" title="Permalink to this headline">¶</a></h2>
<p>Custom requests provide a direct, but asynchronous, communication channel between
an UI item and its plugin. Each request function is identifed by a plugin-unique
uint16 number, which has to be managed by the plugin developer and used consistently
im QML and C++.</p>
<p>The following paragraphs and the <em>Sync File Replay</em> example illustrate the necessary steps to add custom
requests to a plugin.</p>
<div class="section" id="plugin-preparation">
<h3>Plugin Preparation<a class="headerlink" href="#plugin-preparation" title="Permalink to this headline">¶</a></h3>
<p>The plugin class needs a handler to process incoming custom requests.</p>
<p>Add a member</p>
<p><code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;odk::framework::CustomRequestHandler&gt;</span> <span class="pre">m_custom_requests</span></code></p>
<p>and activate it by calling</p>
<p><code class="docutils literal notranslate"><span class="pre">addMessageHandler(m_custom_requests);</span></code></p>
<p>in the constructor.</p>
</div>
<div class="section" id="implementing-request-functions">
<h3>Implementing Request Functions<a class="headerlink" href="#implementing-request-functions" title="Permalink to this headline">¶</a></h3>
<p>Implement the required methods in your plugin.</p>
<p>For each method you can select one of the following signatures:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">std::uint64_t</span> <span class="pre">myCustomRequest(const</span> <span class="pre">odk::PropertyList&amp;</span> <span class="pre">params,</span> <span class="pre">odk::PropertyList&amp;</span> <span class="pre">returns)</span></code></dt><dd><p>This method uses <a class="reference internal" href="property_list.html#property-list-type"><span class="std std-ref">property lists</span></a> as input and
output and can therefore cover almost all use cases.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">std::uint64_t</span> <span class="pre">myXmlRequest(const</span> <span class="pre">odk::PropertyList&amp;</span> <span class="pre">params,</span> <span class="pre">odk::IfXMLValue&amp;</span> <span class="pre">return_xml)</span></code></dt><dd><p>This method received its parameters in a <a class="reference internal" href="property_list.html#property-list-type"><span class="std std-ref">property lists</span></a>
and responds with a single xml document.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">std::uint64_t</span> <span class="pre">myVerySpecialRequest(odk::IfHost*</span> <span class="pre">host,</span> <span class="pre">const</span> <span class="pre">odk::IfValue*</span> <span class="pre">param,</span> <span class="pre">const</span> <span class="pre">odk::IfValue**</span> <span class="pre">ret)</span></code></dt><dd><p>This low-level interface should not be used, because it provides no advantages for
qml items but is more difficult to use correctly.</p>
</dd>
</dl>
<p>Each method has to be registered in the plugin constructor:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="p">::</span><span class="n">uint16_t</span> <span class="n">my_request1_id</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="n">m_custom_requests</span><span class="o">-&gt;</span><span class="n">registerFunction</span><span class="p">(</span><span class="n">my_request1_id</span><span class="p">,</span> <span class="s2">&quot;MyRequest1&quot;</span><span class="p">,</span> <span class="n">std</span><span class="p">::</span><span class="n">bind</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MyPlugin</span><span class="p">::</span><span class="n">myRequest1</span><span class="p">,</span> <span class="n">this</span><span class="p">,</span> <span class="n">arg</span><span class="p">::</span><span class="n">_1</span><span class="p">,</span> <span class="n">arg</span><span class="p">::</span><span class="n">_2</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="performing-a-custom-request">
<h3>Performing a Custom Request<a class="headerlink" href="#performing-a-custom-request" title="Permalink to this headline">¶</a></h3>
<p>The following QML item is used to perform custom requests from QML:</p>
<dl>
<dt>CustomPluginRequest (Oxygen.Tools 1.0)</dt><dd><p>property int <strong>messageId</strong></p>
<blockquote>
<div><p>The id specified when registering the custom request.</p>
</div></blockquote>
<p>readonly property bool <strong>requestPending</strong>: false</p>
<blockquote>
<div><p>Indicates whether an request is currently active and waiting for a response from the plugin.
Only a single request can be active at the same time.</p>
</div></blockquote>
<p>function <strong>request</strong> (parameters)</p>
<blockquote>
<div><p>Start the request using the provided parameters (usually a <a class="reference internal" href="property_list.html#property-list-type"><span class="std std-ref">property list</span></a>).</p>
</div></blockquote>
<p>signal <strong>response</strong> (bool success, int code, var value)</p>
<blockquote>
<div><p>Emitted as soon as the response arrives.
If request was successful the parameters provide the return code as well as the return value.
The value is usually a <a class="reference internal" href="property_list.html#property-list-type"><span class="std std-ref">property list</span></a> or an string containing XML.</p>
</div></blockquote>
</dd>
</dl>
<p>The following example provides easy access to a request using one input and one output parameter:</p>
<div class="highlight-qml notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="nx">Oxygen</span><span class="p">.</span><span class="nx">Tools</span> <span class="mf">1.0</span>

<span class="p">...</span>

<span class="nx">CustomPluginRequest</span> <span class="p">{</span>
    <span class="kd">id: myRequest1</span>
    <span class="k">messageId:</span> <span class="mi">123</span>

    <span class="kd">function</span> <span class="nx">startRequest</span><span class="p">(</span><span class="nx">param</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">props</span> <span class="o">=</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">createPropertyList</span><span class="p">();</span>
        <span class="nx">props</span><span class="p">.</span><span class="nx">setString</span><span class="p">(</span><span class="s2">&quot;param&quot;</span><span class="p">,</span> <span class="nx">param</span><span class="p">);</span>
        <span class="nx">request</span><span class="p">(</span><span class="nx">props</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">onResponse:</span>
    <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">getString</span><span class="p">(</span><span class="s2">&quot;result&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="Example: Sync File Replay" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ui_extensions.html" class="btn btn-neutral float-left" title="UI Extensions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, DEWETRON GmbH

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>